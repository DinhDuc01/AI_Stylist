<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <title>Test Gemini API</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            max-width: 800px; 
            margin: 0 auto;
        }
        .container { margin: 20px 0; }
        .result { 
            margin: 20px 0; 
            padding: 15px; 
            border-radius: 8px; 
            border-left: 4px solid;
        }
        .success { 
            background: #d4edda; 
            border-left-color: #28a745; 
            color: #155724; 
        }
        .error { 
            background: #f8d7da; 
            border-left-color: #dc3545; 
            color: #721c24; 
        }
        .info { 
            background: #d1ecf1; 
            border-left-color: #17a2b8; 
            color: #0c5460; 
        }
        .warning {
            background: #fff3cd;
            border-left-color: #ffc107;
            color: #856404;
        }
        button { 
            padding: 12px 24px; 
            margin: 8px; 
            cursor: pointer; 
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        button:hover { opacity: 0.9; }
        input[type="text"] { 
            padding: 10px; 
            border: 1px solid #ddd; 
            border-radius: 4px; 
            width: 300px;
            margin: 5px;
        }
        pre { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 6px; 
            overflow-x: auto;
            font-size: 12px;
            border: 1px solid #e9ecef;
        }
        .step {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #6c757d;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <h1>ü§ñ Test Google Gemini API</h1>
    
    <div class="warning result">
        <h3>‚ö†Ô∏è H∆∞·ªõng D·∫´n Setup</h3>
        <ol>
            <li>L·∫•y API key t·ª´ <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a></li>
            <li>Nh·∫≠p API key v√†o √¥ b√™n d∆∞·ªõi</li>
            <li>Click "Test API" ƒë·ªÉ ki·ªÉm tra</li>
        </ol>
    </div>

    <div class="container">
        <h3>üîë API Configuration</h3>
        <div>
            <label><strong>Gemini API Key:</strong></label><br>
            <input type="password" id="apiKeyInput" placeholder="AIzaSyC..." style="width: 400px;">
            <button class="btn-warning" onclick="toggleApiKeyVisibility()">üëÅÔ∏è Show/Hide</button>
        </div>
        <div style="margin-top: 10px;">
            <label><strong>Test Prompt:</strong></label><br>
            <input type="text" id="promptInput" value="G·ª£i √Ω outfit cho th·ªùi ti·∫øt 15¬∞C, nhi·ªÅu m√¢y, ƒëi l√†m" style="width: 500px;">
        </div>
    </div>

    <div class="container">
        <h3>üß™ Test Functions</h3>
        <button class="btn-primary" onclick="testGeminiAPI()">üöÄ Test Gemini API</button>
        <button class="btn-success" onclick="testOutfitSuggestion()">üëï Test Outfit Suggestion</button>
        <button class="btn-warning" onclick="showApiInfo()">‚ÑπÔ∏è API Info</button>
    </div>

    <div id="results"></div>

    <div class="step">
        <h4>üìã Checklist Setup</h4>
        <div id="checklist">
            <div>‚ùå API Key ch∆∞a nh·∫≠p</div>
            <div>‚ùå Ch∆∞a test API</div>
            <div>‚ùå Ch∆∞a test outfit suggestion</div>
        </div>
    </div>

    <script>
        let isApiKeyVisible = false;

        function toggleApiKeyVisibility() {
            const input = document.getElementById('apiKeyInput');
            isApiKeyVisible = !isApiKeyVisible;
            input.type = isApiKeyVisible ? 'text' : 'password';
        }

        function updateChecklist() {
            const apiKey = document.getElementById('apiKeyInput').value;
            const checklist = document.getElementById('checklist');
            
            let items = [];
            items.push(apiKey ? '‚úÖ API Key ƒë√£ nh·∫≠p' : '‚ùå API Key ch∆∞a nh·∫≠p');
            items.push('‚ùå Ch∆∞a test API');
            items.push('‚ùå Ch∆∞a test outfit suggestion');
            
            checklist.innerHTML = items.map(item => `<div>${item}</div>`).join('');
        }

        async function testGeminiAPI() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            const prompt = document.getElementById('promptInput').value.trim();
            const resultsDiv = document.getElementById('results');
            
            if (!apiKey) {
                resultsDiv.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå Thi·∫øu API Key</h3>
                        <p>Vui l√≤ng nh·∫≠p Gemini API Key tr∆∞·ªõc khi test!</p>
                    </div>
                `;
                return;
            }

            resultsDiv.innerHTML = `
                <div class="result info">
                    <h3><span class="loading"></span> ƒêang test Gemini API...</h3>
                    <p>Prompt: "${prompt}"</p>
                </div>
            `;

            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 500
                        }
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`HTTP ${response.status}: ${errorData.error?.message || response.statusText}`);
                }

                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;

                resultsDiv.innerHTML = `
                    <div class="result success">
                        <h3>‚úÖ Gemini API ho·∫°t ƒë·ªông t·ªët!</h3>
                        <p><strong>Prompt:</strong> ${prompt}</p>
                        <p><strong>AI Response:</strong></p>
                        <div style="background: white; padding: 15px; border-radius: 6px; margin: 10px 0; border: 1px solid #ddd;">
                            ${aiResponse.replace(/\n/g, '<br>')}
                        </div>
                    </div>
                    <div class="result info">
                        <h4>üìä Raw API Response:</h4>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;

                // Update checklist
                const checklist = document.getElementById('checklist');
                checklist.innerHTML = `
                    <div>‚úÖ API Key ƒë√£ nh·∫≠p</div>
                    <div>‚úÖ Test API th√†nh c√¥ng</div>
                    <div>‚ùå Ch∆∞a test outfit suggestion</div>
                `;

            } catch (error) {
                console.error('Gemini API Error:', error);
                
                resultsDiv.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå L·ªói Gemini API</h3>
                        <p><strong>L·ªói:</strong> ${error.message}</p>
                        <p><strong>API Key:</strong> ${apiKey.substring(0, 10)}...</p>
                    </div>
                    <div class="result info">
                        <h4>üîß C√°ch kh·∫Øc ph·ª•c:</h4>
                        <ul>
                            <li>Ki·ªÉm tra API key c√≥ ƒë√∫ng kh√¥ng (ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng "AIza")</li>
                            <li>ƒê·∫£m b·∫£o API key ƒë∆∞·ª£c enable t·∫°i Google AI Studio</li>
                            <li>Ki·ªÉm tra quota (15 requests/ph√∫t)</li>
                            <li>Th·ª≠ l·∫°i sau 1 ph√∫t n·∫øu b·ªã rate limit</li>
                        </ul>
                    </div>
                `;
            }
        }

        async function testOutfitSuggestion() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            const resultsDiv = document.getElementById('results');
            
            if (!apiKey) {
                resultsDiv.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå Thi·∫øu API Key</h3>
                        <p>Vui l√≤ng nh·∫≠p Gemini API Key tr∆∞·ªõc!</p>
                    </div>
                `;
                return;
            }

            const outfitPrompt = `
B·∫°n l√† chuy√™n gia th·ªùi trang AI. 

Th·ªùi ti·∫øt hi·ªán t·∫°i:
- Nhi·ªát ƒë·ªô: 15¬∞C (c·∫£m gi√°c nh∆∞ 13¬∞C)
- Th·ªùi ti·∫øt: Nhi·ªÅu m√¢y
- ƒê·ªô ·∫©m: 75%
- Gi√≥: 10 km/h

Ho·∫°t ƒë·ªông: ƒêi l√†m

T·ªß ƒë·ªì c√≥ s·∫µn:
- √Åo: √Åo s∆° mi tr·∫Øng (Tr·∫Øng, Cotton)
- √Åo: √Åo thun ƒëen (ƒêen, Cotton)  
- √Åo: √Åo hoodie x√°m (X√°m, N·ªâ)
- √Åo: √Åo len c·ªï l·ªç (Beige, Len)
- Qu·∫ßn: Qu·∫ßn jeans xanh (Xanh denim, Denim)
- Qu·∫ßn: Qu·∫ßn √¢u ƒëen (ƒêen, Polyester)
- Gi√†y: Sneaker tr·∫Øng (Tr·∫Øng, Da t·ªïng h·ª£p)
- Gi√†y: Gi√†y da n√¢u (N√¢u, Da th·∫≠t)

H√£y g·ª£i √Ω outfit c·ª• th·ªÉ t·ª´ t·ªß ƒë·ªì c√≥ s·∫µn, bao g·ªìm:
1. √Åo (lo·∫°i, m√†u, ch·∫•t li·ªáu)
2. Qu·∫ßn (lo·∫°i, m√†u)  
3. Gi√†y d√©p
4. Ph·ª• ki·ªán (n·∫øu c·∫ßn)
5. L√Ω do t·∫°i sao ph√π h·ª£p

Format: JSON v·ªõi c√°c tr∆∞·ªùng: top, bottom, shoes, accessories, reason, comfort_score (1-10)
            `;

            resultsDiv.innerHTML = `
                <div class="result info">
                    <h3><span class="loading"></span> ƒêang test Outfit Suggestion...</h3>
                </div>
            `;

            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: outfitPrompt
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 500
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;

                resultsDiv.innerHTML = `
                    <div class="result success">
                        <h3>‚úÖ Outfit Suggestion th√†nh c√¥ng!</h3>
                        <div style="background: white; padding: 15px; border-radius: 6px; margin: 10px 0; border: 1px solid #ddd;">
                            <h4>ü§ñ AI G·ª£i √ù:</h4>
                            ${aiResponse.replace(/\n/g, '<br>')}
                        </div>
                    </div>
                `;

                // Update checklist
                const checklist = document.getElementById('checklist');
                checklist.innerHTML = `
                    <div>‚úÖ API Key ƒë√£ nh·∫≠p</div>
                    <div>‚úÖ Test API th√†nh c√¥ng</div>
                    <div>‚úÖ Test outfit suggestion th√†nh c√¥ng</div>
                `;

            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="result error">
                        <h3>‚ùå L·ªói Outfit Suggestion</h3>
                        <p><strong>L·ªói:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }

        function showApiInfo() {
            const resultsDiv = document.getElementById('results');
            
            resultsDiv.innerHTML = `
                <div class="result info">
                    <h3>‚ÑπÔ∏è Th√¥ng Tin Gemini API</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0;">
                        <div>
                            <h4>üìä Gi·ªõi H·∫°n Mi·ªÖn Ph√≠:</h4>
                            <ul>
                                <li><strong>15 requests/ph√∫t</strong></li>
                                <li><strong>1,500 requests/ng√†y</strong></li>
                                <li><strong>45,000 requests/th√°ng</strong></li>
                                <li><strong>30,000 tokens/request</strong></li>
                            </ul>
                        </div>
                        <div>
                            <h4>üîó Links H·ªØu √çch:</h4>
                            <ul>
                                <li><a href="https://aistudio.google.com/app/apikey" target="_blank">L·∫•y API Key</a></li>
                                <li><a href="https://ai.google.dev/docs" target="_blank">Documentation</a></li>
                                <li><a href="https://aistudio.google.com/app/prompts/new_chat" target="_blank">Test Prompts</a></li>
                            </ul>
                        </div>
                    </div>
                    <div style="background: #fff3cd; padding: 10px; border-radius: 6px; margin: 10px 0;">
                        <strong>üí° Tip:</strong> N·∫øu b·ªã rate limit (429), ƒë·ª£i 1 ph√∫t r·ªìi th·ª≠ l·∫°i!
                    </div>
                </div>
            `;
        }

        // Auto update checklist when API key changes
        document.getElementById('apiKeyInput').addEventListener('input', updateChecklist);
        
        // Initialize
        updateChecklist();
    </script>
</body>
</html>
