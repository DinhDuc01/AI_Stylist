<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <title>Simple Weather Test</title>
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <style>
        .weather-card { background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); color: white; padding: 30px; border-radius: 20px; text-align: center; margin: 20px 0; }
        .outfit-item { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 10px; }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>üå§Ô∏è Simple Weather Test</h1>
        
        <button class="btn btn-primary" onclick="loadWeatherAndOutfit()">Load Weather & Outfit</button>
        
        <div id="weatherCard" class="weather-card" style="display: none;">
            <h3 id="temperature">--¬∞C</h3>
            <p id="condition">Loading...</p>
            <p id="location">--</p>
        </div>
        
        <div id="outfitSuggestion" class="mt-4" style="display: none;">
            <h4>üëï AI Outfit Suggestion</h4>
            <div id="outfitItems"></div>
        </div>
        
        <div id="errorMessage" class="alert alert-danger" style="display: none;"></div>
    </div>

    <script>
        const WEATHER_API_KEY = 'd1ca006774aa4d9491d21940250611';
        const GEMINI_API_KEY = 'AIzaSyBYgj63cniNH6OyRmGifLNo7peqgU_L6k8';

        async function loadWeatherAndOutfit() {
            try {
                // 1. Get Weather
                console.log('Getting weather...');
                const weather = await getWeather();
                displayWeather(weather);
                
                // 2. Get AI Suggestion
                console.log('Getting AI suggestion...');
                const suggestion = await getAISuggestion(weather);
                displayOutfit(suggestion);
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('errorMessage').textContent = `Error: ${error.message}`;
            }
        }

        async function getWeather() {
            const response = await fetch(`https://api.weatherapi.com/v1/current.json?key=${WEATHER_API_KEY}&q=Hanoi&lang=vi`);
            
            if (!response.ok) {
                throw new Error(`Weather API Error: ${response.status}`);
            }
            
            const data = await response.json();
            return {
                temperature: data.current.temp_c,
                condition: data.current.condition.text,
                location: `${data.location.name}, ${data.location.country}`,
                humidity: data.current.humidity,
                windSpeed: data.current.wind_kph
            };
        }

        async function getAISuggestion(weather) {
            const prompt = `Th·ªùi ti·∫øt hi·ªán t·∫°i ·ªü H√† N·ªôi: ${weather.temperature}¬∞C, ${weather.condition}. 
H√£y g·ª£i √Ω outfit ph√π h·ª£p cho ƒëi l√†m. Tr·∫£ l·ªùi ng·∫Øn g·ªçn b·∫±ng ti·∫øng Vi·ªát.`;

            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${GEMINI_API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: { temperature: 0.7, maxOutputTokens: 300 }
                })
            });

            if (!response.ok) {
                throw new Error(`Gemini API Error: ${response.status}`);
            }

            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        function displayWeather(weather) {
            document.getElementById('temperature').textContent = `${weather.temperature}¬∞C`;
            document.getElementById('condition').textContent = weather.condition;
            document.getElementById('location').textContent = weather.location;
            document.getElementById('weatherCard').style.display = 'block';
        }

        function displayOutfit(suggestion) {
            document.getElementById('outfitItems').innerHTML = `
                <div class="outfit-item">
                    <h6>ü§ñ AI G·ª£i √ù:</h6>
                    <p>${suggestion.replace(/\n/g, '<br>')}</p>
                </div>
            `;
            document.getElementById('outfitSuggestion').style.display = 'block';
        }
    </script>
</body>
</html>
